//---
//layout: page
//title: Enterprise Goggles.
//---

<h2><a name="A-typical-enterprise-problem" class="anchor" href="#A-typical-enterprise-problem">A typical enterprise problem</a></h2>

<p>Based on a gut feel and no real evidence :) apart from my own experience I would say that a large proportion of enterprise applications are essentially just some sort of Extract - Transform - Load for system A to system B.</p>

<p>For the sake of argument, lets say that the requirement for our application is to read data from a <a href="/code/data/lenses/source_data.xml">XML file</a>, apply some transformation (say convert the sizes to a standard size definition S, M, L, XL) and then write it out to another CSV file.</p>

<p>So we can start by defining to functions to convert the sizes</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs79', 174)" onmouseover="showTip(event, 'fs79', 174)" class="i">longSizeToShortSize</span> <span class="o">=</span> <span class="k">function</span> 
        | <span class="s">&quot;</span><span class="s">Small</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">S</span><span class="s">&quot;</span>
        | <span class="s">&quot;</span><span class="s">Medium</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">M</span><span class="s">&quot;</span>
        | <span class="s">&quot;</span><span class="s">Large</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">L</span><span class="s">&quot;</span>
        | <span class="s">&quot;</span><span class="s">Extra</span><span class="s"> </span><span class="s">Large</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">XL</span><span class="s">&quot;</span>
        | <span onmouseout="hideTip(event, 'fs80', 175)" onmouseover="showTip(event, 'fs80', 175)" class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs80', 176)" onmouseover="showTip(event, 'fs80', 176)" class="i">a</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs81', 177)" onmouseover="showTip(event, 'fs81', 177)" class="i">shortSizeToLongSize</span> <span class="o">=</span> <span class="k">function</span>  
        | <span class="s">&quot;</span><span class="s">S</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">Small</span><span class="s">&quot;</span>
        | <span class="s">&quot;</span><span class="s">M</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">Medium</span><span class="s">&quot;</span>
        | <span class="s">&quot;</span><span class="s">L</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">Large</span><span class="s">&quot;</span>
        | <span class="s">&quot;</span><span class="s">XL</span><span class="s">&quot;</span> <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">Extra</span><span class="s"> </span><span class="s">Large</span><span class="s">&quot;</span>
        | <span onmouseout="hideTip(event, 'fs80', 178)" onmouseover="showTip(event, 'fs80', 178)" class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs80', 179)" onmouseover="showTip(event, 'fs80', 179)" class="i">a</span></pre>
</td>
</tr>
</table>

<p>Now this is a fairly trivial problem, to solve and there are many ways to do it, for example a one solution might be to use a type provider and a simple CSV File representation do something like the following.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs82', 180)" onmouseover="showTip(event, 'fs82', 180)" class="i">Catalog</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs83', 181)" onmouseover="showTip(event, 'fs83', 181)" class="i">XmlProvider</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">data</span><span class="s">/</span><span class="s">lenses</span><span class="s">/</span><span class="s">source_data</span><span class="s">.</span><span class="s">xml</span><span class="s">&quot;</span><span class="o">&gt;</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs84', 182)" onmouseover="showTip(event, 'fs84', 182)" class="i">run</span> (<span onmouseout="hideTip(event, 'fs74', 183)" onmouseover="showTip(event, 'fs74', 183)" class="i">path</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs15', 184)" onmouseover="showTip(event, 'fs15', 184)" class="i">string</span>) <span class="o">=</span>  
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 185)" onmouseover="showTip(event, 'fs85', 185)" class="i">data</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs82', 186)" onmouseover="showTip(event, 'fs82', 186)" class="i">Catalog</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs86', 187)" onmouseover="showTip(event, 'fs86', 187)" class="i">Load</span>(<span onmouseout="hideTip(event, 'fs74', 188)" onmouseover="showTip(event, 'fs74', 188)" class="i">path</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 189)" onmouseover="showTip(event, 'fs21', 189)" class="i">data</span> <span class="o">=</span> 
            [|
                <span class="k">for</span> <span onmouseout="hideTip(event, 'fs87', 190)" onmouseover="showTip(event, 'fs87', 190)" class="i">product</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs85', 191)" onmouseover="showTip(event, 'fs85', 191)" class="i">data</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 192)" onmouseover="showTip(event, 'fs88', 192)" class="i">Products</span> <span class="k">do</span>
                    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs89', 193)" onmouseover="showTip(event, 'fs89', 193)" class="i">catalogItem</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs87', 194)" onmouseover="showTip(event, 'fs87', 194)" class="i">product</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 195)" onmouseover="showTip(event, 'fs90', 195)" class="i">CatalogItems</span> <span class="k">do</span>
                    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs91', 196)" onmouseover="showTip(event, 'fs91', 196)" class="i">size</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs89', 197)" onmouseover="showTip(event, 'fs89', 197)" class="i">catalogItem</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 198)" onmouseover="showTip(event, 'fs92', 198)" class="i">Sizes</span> <span class="k">do</span>
                        <span class="k">yield</span> [| <span onmouseout="hideTip(event, 'fs89', 199)" onmouseover="showTip(event, 'fs89', 199)" class="i">catalogItem</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 200)" onmouseover="showTip(event, 'fs93', 200)" class="i">ItemNumber</span> 
                                 <span onmouseout="hideTip(event, 'fs87', 201)" onmouseover="showTip(event, 'fs87', 201)" class="i">product</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs94', 202)" onmouseover="showTip(event, 'fs94', 202)" class="i">Description</span> 
                                 <span onmouseout="hideTip(event, 'fs89', 203)" onmouseover="showTip(event, 'fs89', 203)" class="i">catalogItem</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs95', 204)" onmouseover="showTip(event, 'fs95', 204)" class="i">Gender</span>
                                 <span onmouseout="hideTip(event, 'fs91', 205)" onmouseover="showTip(event, 'fs91', 205)" class="i">size</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs96', 206)" onmouseover="showTip(event, 'fs96', 206)" class="i">Description</span>
                                 <span onmouseout="hideTip(event, 'fs79', 207)" onmouseover="showTip(event, 'fs79', 207)" class="i">longSizeToShortSize</span> <span onmouseout="hideTip(event, 'fs91', 208)" onmouseover="showTip(event, 'fs91', 208)" class="i">size</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs96', 209)" onmouseover="showTip(event, 'fs96', 209)" class="i">Description</span>
                                 <span onmouseout="hideTip(event, 'fs89', 210)" onmouseover="showTip(event, 'fs89', 210)" class="i">catalogItem</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 211)" onmouseover="showTip(event, 'fs97', 211)" class="i">Price</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 212)" onmouseover="showTip(event, 'fs15', 212)" class="i">string</span>
                              |]
            |]
        <span onmouseout="hideTip(event, 'fs98', 213)" onmouseover="showTip(event, 'fs98', 213)" class="i">Csv</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs99', 214)" onmouseover="showTip(event, 'fs99', 214)" class="i">Create</span>([|<span class="s">&quot;</span><span class="s">item_no</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">description</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">gender</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">size</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">short_size</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">price</span><span class="s">&quot;</span>|],<span onmouseout="hideTip(event, 'fs21', 215)" onmouseover="showTip(event, 'fs21', 215)" class="i">data</span>)</pre>
</td>
</tr>
</table>

<p>which gives us</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="i">item_no</span>,<span class="i">description</span>,<span class="i">gender</span>,<span class="i">size</span>,<span class="i">short_size</span>,<span class="i">price</span>
<span class="i">QWZ5671</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Men&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">39.95</span>
<span class="i">QWZ5671</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Men&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">39.95</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Small</span>,<span class="i">S</span>,<span class="n">42.50</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">42.50</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">42.50</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Extra</span> <span class="i">Large</span>,<span class="i">XL</span>,<span class="n">42.50</span>
<span class="i">QWZ8976</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Men&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">39.95</span>
<span class="i">QWZ8976</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Men&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">39.95</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Small</span>,<span class="i">S</span>,<span class="n">42.50</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">42.50</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">42.50</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Extra</span> <span class="i">Large</span>,<span class="i">XL</span>,<span class="n">42.50</span></pre>
</td>
</tr>
</table>

<p>this implementation is all well and good for a one off. It works and is maintainable, in the sense that the code is consise and easy to follow. However there are a few issues. Since this is the enterprise, everytime a business process changes or a external regulatory change happens it is likely that the data format is going to change. It would therefore be nice to be able to change the format without having to re-write everything, in fact in enterprises I have seen release times beyond 6 weeks, so ideally we would like to push as much to scripts or configuation as we can. Also some type providers don't deal well with data that isn't in the same format (missing nodes / properties) as the example provided at compile time; Additionally because they are typically erased, reflection is out of the question, so putting the property mapping in a configuration file, is made significantly more complicated. Now of-course we can always introduce some higher-order functions to abstract aways these problems, but this would be specific to this solution. It would be nice to try and solve this in a more general way.</p>

<h2><a name="Introducing-Optics" class="anchor" href="#Introducing-Optics">Introducing Optics</a></h2>

<p>At <a href="https://skillsmatter.com/conferences/7145-f-exchange-2016#program">F# exchange</a>, I got into a couple of conversations around enterprise development and the patterns that I use when developing line of business applications with F#. Typically the discussion focused on the lack of need for patterns. This is mainly due F#'s strong type system and the fact that higher order functions are a <a href="https://www.infoq.com/presentations/fp-design-patterns">pretty powerful abstraction</a>. However one topic that promoted a certain amount of contention was Lenses or more generally Optics.</p>

<p>Now I can't say I am surprised by this there are a couple of reasons why,</p>

<ul>
<li><p><em>Performance</em> - Extra Allocations caused by individually setting properties on records can have a reasonable performace impact when used in time critical code.</p></li>
<li><p><em>No Language Support</em> - Writing lenses for records can be a large overhead and currently there is no language support. Maybe this will happen in the <a href="https://fslang.uservoice.com/forums/245727-f-language/suggestions/6906132-implement-first-class-lensing-lenses-in-f">future</a> who knows??</p></li>
</ul>

<p>With this considered thou, performance is often not so important in the enterprise, and even maintainability is often sacrificed in the aim of making things flexible. Now there is probably an entire other blog post around why this is the case but thats for another day. So what does an optic solution look like to this problem. Well we can first start by defining some Optics over an XML structure accessed using XPATH and one over CSV.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs100', 216)" onmouseover="showTip(event, 'fs100', 216)" class="i">xpath</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span> (<span onmouseout="hideTip(event, 'fs74', 217)" onmouseover="showTip(event, 'fs74', 217)" class="i">path</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs15', 218)" onmouseover="showTip(event, 'fs15', 218)" class="i">string</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs101', 219)" onmouseover="showTip(event, 'fs101', 219)" class="i">Lens</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs102', 220)" onmouseover="showTip(event, 'fs102', 220)" class="i">XElement</span>, _<span class="o">&gt;</span> <span class="o">=</span> 
        (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs103', 221)" onmouseover="showTip(event, 'fs103', 221)" class="i">x</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs103', 222)" onmouseover="showTip(event, 'fs103', 222)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 223)" onmouseover="showTip(event, 'fs104', 223)" class="i">XPathEvaluate</span>(<span onmouseout="hideTip(event, 'fs74', 224)" onmouseover="showTip(event, 'fs74', 224)" class="i">path</span>) <span class="o">:?&gt;</span> <span onmouseout="hideTip(event, 'fs105', 225)" onmouseover="showTip(event, 'fs105', 225)" class="i">IEnumerable</span>)<span class="o">.</span><span class="i">Cast</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span>()<span class="o">.</span><span class="i">FirstOrDefault</span>()),
        (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs106', 226)" onmouseover="showTip(event, 'fs106', 226)" class="i">s</span> <span onmouseout="hideTip(event, 'fs103', 227)" onmouseover="showTip(event, 'fs103', 227)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs103', 228)" onmouseover="showTip(event, 'fs103', 228)" class="i">x</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs107', 229)" onmouseover="showTip(event, 'fs107', 229)" class="i">xml</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs108', 230)" onmouseover="showTip(event, 'fs108', 230)" class="i">defaultV</span> <span onmouseout="hideTip(event, 'fs74', 231)" onmouseover="showTip(event, 'fs74', 231)" class="i">path</span> <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs109', 232)" onmouseover="showTip(event, 'fs109', 232)" class="i">getValue</span> <span onmouseout="hideTip(event, 'fs108', 233)" onmouseover="showTip(event, 'fs108', 233)" class="i">defaultV</span> (<span onmouseout="hideTip(event, 'fs110', 234)" onmouseover="showTip(event, 'fs110', 234)" class="i">x</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs111', 235)" onmouseover="showTip(event, 'fs111', 235)" class="i">obj</span>) <span class="o">=</span>
          <span class="k">match</span> <span onmouseout="hideTip(event, 'fs110', 236)" onmouseover="showTip(event, 'fs110', 236)" class="i">x</span> <span class="k">with</span>
          | <span class="k">null</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs108', 237)" onmouseover="showTip(event, 'fs108', 237)" class="i">defaultV</span>
          | <span class="o">:?</span> <span onmouseout="hideTip(event, 'fs112', 238)" onmouseover="showTip(event, 'fs112', 238)" class="i">XAttribute</span> <span class="k">as</span> <span onmouseout="hideTip(event, 'fs113', 239)" onmouseover="showTip(event, 'fs113', 239)" class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs113', 240)" onmouseover="showTip(event, 'fs113', 240)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs114', 241)" onmouseover="showTip(event, 'fs114', 241)" class="i">Value</span>
          | <span class="o">:?</span> <span onmouseout="hideTip(event, 'fs102', 242)" onmouseover="showTip(event, 'fs102', 242)" class="i">XElement</span> <span class="k">as</span> <span onmouseout="hideTip(event, 'fs115', 243)" onmouseover="showTip(event, 'fs115', 243)" class="i">e</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs115', 244)" onmouseover="showTip(event, 'fs115', 244)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs116', 245)" onmouseover="showTip(event, 'fs116', 245)" class="i">Value</span>
          | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs35', 246)" onmouseover="showTip(event, 'fs35', 246)" class="i">failwithf</span> <span class="s">&quot;</span><span class="s">unable</span><span class="s"> </span><span class="s">to</span><span class="s"> </span><span class="s">get</span><span class="s"> </span><span class="s">value</span><span class="s"> </span><span class="s">on</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs110', 247)" onmouseover="showTip(event, 'fs110', 247)" class="i">x</span>

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs117', 248)" onmouseover="showTip(event, 'fs117', 248)" class="i">setValue</span> (<span onmouseout="hideTip(event, 'fs110', 249)" onmouseover="showTip(event, 'fs110', 249)" class="i">x</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs111', 250)" onmouseover="showTip(event, 'fs111', 250)" class="i">obj</span>) <span onmouseout="hideTip(event, 'fs118', 251)" onmouseover="showTip(event, 'fs118', 251)" class="i">v</span> <span class="o">=</span> 
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs110', 252)" onmouseover="showTip(event, 'fs110', 252)" class="i">x</span> <span class="k">with</span>
            | <span class="o">:?</span> <span onmouseout="hideTip(event, 'fs112', 253)" onmouseover="showTip(event, 'fs112', 253)" class="i">XAttribute</span> <span class="k">as</span> <span onmouseout="hideTip(event, 'fs113', 254)" onmouseover="showTip(event, 'fs113', 254)" class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs113', 255)" onmouseover="showTip(event, 'fs113', 255)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs119', 256)" onmouseover="showTip(event, 'fs119', 256)" class="i">SetValue</span>(<span onmouseout="hideTip(event, 'fs118', 257)" onmouseover="showTip(event, 'fs118', 257)" class="i">v</span>)
            | <span class="o">:?</span> <span onmouseout="hideTip(event, 'fs102', 258)" onmouseover="showTip(event, 'fs102', 258)" class="i">XElement</span> <span class="k">as</span> <span onmouseout="hideTip(event, 'fs115', 259)" onmouseover="showTip(event, 'fs115', 259)" class="i">e</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs115', 260)" onmouseover="showTip(event, 'fs115', 260)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs120', 261)" onmouseover="showTip(event, 'fs120', 261)" class="i">SetValue</span>(<span onmouseout="hideTip(event, 'fs118', 262)" onmouseover="showTip(event, 'fs118', 262)" class="i">v</span>)
            | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs35', 263)" onmouseover="showTip(event, 'fs35', 263)" class="i">failwithf</span> <span class="s">&quot;</span><span class="s">unable</span><span class="s"> </span><span class="s">to</span><span class="s"> </span><span class="s">set</span><span class="s"> </span><span class="s">value</span><span class="s"> </span><span class="s">%</span><span class="s">O</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs110', 264)" onmouseover="showTip(event, 'fs110', 264)" class="i">x</span>
            <span onmouseout="hideTip(event, 'fs121', 265)" onmouseover="showTip(event, 'fs121', 265)" class="i">unbox</span><span class="o">&lt;</span>_<span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs110', 266)" onmouseover="showTip(event, 'fs110', 266)" class="i">x</span>
        
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs122', 267)" onmouseover="showTip(event, 'fs122', 267)" class="i">l</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs101', 268)" onmouseover="showTip(event, 'fs101', 268)" class="i">Lens</span><span class="o">&lt;</span>_,_<span class="o">&gt;</span> <span class="o">=</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs123', 269)" onmouseover="showTip(event, 'fs123', 269)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs109', 270)" onmouseover="showTip(event, 'fs109', 270)" class="i">getValue</span> <span onmouseout="hideTip(event, 'fs108', 271)" onmouseover="showTip(event, 'fs108', 271)" class="i">defaultV</span> <span onmouseout="hideTip(event, 'fs123', 272)" onmouseover="showTip(event, 'fs123', 272)" class="i">x</span>), (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs124', 273)" onmouseover="showTip(event, 'fs124', 273)" class="i">s</span> <span onmouseout="hideTip(event, 'fs123', 274)" onmouseover="showTip(event, 'fs123', 274)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs117', 275)" onmouseover="showTip(event, 'fs117', 275)" class="i">setValue</span> <span onmouseout="hideTip(event, 'fs123', 276)" onmouseover="showTip(event, 'fs123', 276)" class="i">x</span> <span onmouseout="hideTip(event, 'fs124', 277)" onmouseover="showTip(event, 'fs124', 277)" class="i">s</span>)
        <span onmouseout="hideTip(event, 'fs100', 278)" onmouseover="showTip(event, 'fs100', 278)" class="i">xpath</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs74', 279)" onmouseover="showTip(event, 'fs74', 279)" class="i">path</span> <span class="o">&gt;</span><span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs122', 280)" onmouseover="showTip(event, 'fs122', 280)" class="i">l</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs125', 281)" onmouseover="showTip(event, 'fs125', 281)" class="i">xattr</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs107', 282)" onmouseover="showTip(event, 'fs107', 282)" class="i">xml</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs112', 283)" onmouseover="showTip(event, 'fs112', 283)" class="i">XAttribute</span><span class="o">&gt;</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs126', 284)" onmouseover="showTip(event, 'fs126', 284)" class="i">xelem</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs107', 285)" onmouseover="showTip(event, 'fs107', 285)" class="i">xml</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs102', 286)" onmouseover="showTip(event, 'fs102', 286)" class="i">XElement</span><span class="o">&gt;</span> 

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs127', 287)" onmouseover="showTip(event, 'fs127', 287)" class="i">csv</span> <span onmouseout="hideTip(event, 'fs43', 288)" onmouseover="showTip(event, 'fs43', 288)" class="i">indx</span> (<span onmouseout="hideTip(event, 'fs42', 289)" onmouseover="showTip(event, 'fs42', 289)" class="i">col</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs15', 290)" onmouseover="showTip(event, 'fs15', 290)" class="i">string</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs128', 291)" onmouseover="showTip(event, 'fs128', 291)" class="i">Prism</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs98', 292)" onmouseover="showTip(event, 'fs98', 292)" class="i">Csv</span>, _<span class="o">&gt;</span> <span class="o">=</span>
        (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs40', 293)" onmouseover="showTip(event, 'fs40', 293)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs40', 294)" onmouseover="showTip(event, 'fs40', 294)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs129', 295)" onmouseover="showTip(event, 'fs129', 295)" class="i">GetValue</span>(<span onmouseout="hideTip(event, 'fs42', 296)" onmouseover="showTip(event, 'fs42', 296)" class="i">col</span>,<span onmouseout="hideTip(event, 'fs43', 297)" onmouseover="showTip(event, 'fs43', 297)" class="i">indx</span>)),
        (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs124', 298)" onmouseover="showTip(event, 'fs124', 298)" class="i">s</span> <span onmouseout="hideTip(event, 'fs40', 299)" onmouseover="showTip(event, 'fs40', 299)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs40', 300)" onmouseover="showTip(event, 'fs40', 300)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs58', 301)" onmouseover="showTip(event, 'fs58', 301)" class="i">SetValue</span>(<span onmouseout="hideTip(event, 'fs42', 302)" onmouseover="showTip(event, 'fs42', 302)" class="i">col</span>, <span onmouseout="hideTip(event, 'fs43', 303)" onmouseover="showTip(event, 'fs43', 303)" class="i">indx</span>, <span onmouseout="hideTip(event, 'fs124', 304)" onmouseover="showTip(event, 'fs124', 304)" class="i">s</span>); <span onmouseout="hideTip(event, 'fs40', 305)" onmouseover="showTip(event, 'fs40', 305)" class="i">x</span>)</pre>
</td>
</tr>
</table>

<p>Here I am using <a href="https://github.com/xyncro/aether">Aether</a> a lens library by Andrew Cherry and a simple (CSV file representation)[<a href="https://gist.github.com/colinbull/60797d5377be4d841f51e4f0776a24fa">https://gist.github.com/colinbull/60797d5377be4d841f51e4f0776a24fa</a>] but you could use anything. If you have never used Optics or just simply want a refresher then I might suggest the guide to Aether which can be found (here)[<a href="https://xyncro.tech/aether/guides/">https://xyncro.tech/aether/guides/</a>]. Also after you have read that guide you may notice that I'm not defining Optics per se, instead I'm defining functions that return optics a subtle but important distinction.</p>

<p>Now we have our optics (sorry, functions) we can define our mappings. But first we need to add a little extra to our domain functions, so we can use them with Optics. In terms of transformations there are three things we can compose with Optics. Optics, Isomorphisms (a reversible function e.g. <code>string -&gt; char[]</code> and <code>char[] -&gt; string</code>) and Epimorphisms (which is a weaker version of the Isomorphism in that the left hand conversion may fail e.g. <code>string -&gt; char[] option</code> and <code>char[] -&gt; string</code>). For our little problem we only need to concern ourselves with the former since we have a total function (since we include the unknown mappings). So we can define our isomorphism as follows.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs130', 306)" onmouseover="showTip(event, 'fs130', 306)" class="i">shortSize</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs131', 307)" onmouseover="showTip(event, 'fs131', 307)" class="i">Isomorphism</span><span class="o">&lt;</span>_,_<span class="o">&gt;</span> <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs81', 308)" onmouseover="showTip(event, 'fs81', 308)" class="i">shortSizeToLongSize</span>,
        <span onmouseout="hideTip(event, 'fs79', 309)" onmouseover="showTip(event, 'fs79', 309)" class="i">longSizeToShortSize</span></pre>
</td>
</tr>
</table>

<p>Now we can represent our mappings as a simple list of tuples the first item in the tuple is the optic we shall use to read the data using XPATH, the second item is the optic we shall use to set the data (pop it into our CSV file representation).</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs132', 310)" onmouseover="showTip(event, 'fs132', 310)" class="i">mappings</span> <span onmouseout="hideTip(event, 'fs43', 311)" onmouseover="showTip(event, 'fs43', 311)" class="i">indx</span> <span class="o">=</span>  
        [
           <span onmouseout="hideTip(event, 'fs126', 312)" onmouseover="showTip(event, 'fs126', 312)" class="i">xelem</span> <span class="s">&quot;</span><span class="s">NULL</span><span class="s">&quot;</span> <span class="s">&quot;</span><span class="s">parent</span><span class="s">:</span><span class="s">:</span><span class="s">catalog_item</span><span class="s">/</span><span class="s">item_number</span><span class="s">&quot;</span>, (<span onmouseout="hideTip(event, 'fs127', 313)" onmouseover="showTip(event, 'fs127', 313)" class="i">csv</span> <span onmouseout="hideTip(event, 'fs43', 314)" onmouseover="showTip(event, 'fs43', 314)" class="i">indx</span> <span class="s">&quot;</span><span class="s">item_no</span><span class="s">&quot;</span>)
           <span onmouseout="hideTip(event, 'fs125', 315)" onmouseover="showTip(event, 'fs125', 315)" class="i">xattr</span> <span class="s">&quot;</span><span class="s">NULL</span><span class="s">&quot;</span> <span class="s">&quot;</span><span class="s">ancestor</span><span class="s">:</span><span class="s">:</span><span class="s">product</span><span class="s">/</span><span class="s">@</span><span class="s">description</span><span class="s">&quot;</span>, (<span onmouseout="hideTip(event, 'fs127', 316)" onmouseover="showTip(event, 'fs127', 316)" class="i">csv</span> <span onmouseout="hideTip(event, 'fs43', 317)" onmouseover="showTip(event, 'fs43', 317)" class="i">indx</span> <span class="s">&quot;</span><span class="s">description</span><span class="s">&quot;</span>)
           <span onmouseout="hideTip(event, 'fs125', 318)" onmouseover="showTip(event, 'fs125', 318)" class="i">xattr</span> <span class="s">&quot;</span><span class="s">NULL</span><span class="s">&quot;</span> <span class="s">&quot;</span><span class="s">parent</span><span class="s">:</span><span class="s">:</span><span class="s">catalog_item</span><span class="s">/</span><span class="s">@</span><span class="s">gender</span><span class="s">&quot;</span>, (<span onmouseout="hideTip(event, 'fs127', 319)" onmouseover="showTip(event, 'fs127', 319)" class="i">csv</span> <span onmouseout="hideTip(event, 'fs43', 320)" onmouseover="showTip(event, 'fs43', 320)" class="i">indx</span> <span class="s">&quot;</span><span class="s">gender</span><span class="s">&quot;</span>)
           <span onmouseout="hideTip(event, 'fs125', 321)" onmouseover="showTip(event, 'fs125', 321)" class="i">xattr</span> <span class="s">&quot;</span><span class="s">NULL</span><span class="s">&quot;</span> <span class="s">&quot;</span><span class="s">@</span><span class="s">description</span><span class="s">&quot;</span>, (<span onmouseout="hideTip(event, 'fs127', 322)" onmouseover="showTip(event, 'fs127', 322)" class="i">csv</span> <span onmouseout="hideTip(event, 'fs43', 323)" onmouseover="showTip(event, 'fs43', 323)" class="i">indx</span> <span class="s">&quot;</span><span class="s">size</span><span class="s">&quot;</span>)
           <span onmouseout="hideTip(event, 'fs125', 324)" onmouseover="showTip(event, 'fs125', 324)" class="i">xattr</span> <span class="s">&quot;</span><span class="s">NULL</span><span class="s">&quot;</span> <span class="s">&quot;</span><span class="s">@</span><span class="s">description</span><span class="s">&quot;</span>, (<span onmouseout="hideTip(event, 'fs127', 325)" onmouseover="showTip(event, 'fs127', 325)" class="i">csv</span> <span onmouseout="hideTip(event, 'fs43', 326)" onmouseover="showTip(event, 'fs43', 326)" class="i">indx</span> <span class="s">&quot;</span><span class="s">short_size</span><span class="s">&quot;</span> <span class="o">&gt;</span><span class="o">?&gt;</span> <span onmouseout="hideTip(event, 'fs130', 327)" onmouseover="showTip(event, 'fs130', 327)" class="i">shortSize</span>)
           <span onmouseout="hideTip(event, 'fs126', 328)" onmouseover="showTip(event, 'fs126', 328)" class="i">xelem</span> <span class="s">&quot;</span><span class="s">NULL</span><span class="s">&quot;</span> <span class="s">&quot;</span><span class="s">parent</span><span class="s">:</span><span class="s">:</span><span class="s">catalog_item</span><span class="s">/</span><span class="s">price</span><span class="s">&quot;</span>, (<span onmouseout="hideTip(event, 'fs127', 329)" onmouseover="showTip(event, 'fs127', 329)" class="i">csv</span> <span onmouseout="hideTip(event, 'fs43', 330)" onmouseover="showTip(event, 'fs43', 330)" class="i">indx</span> <span class="s">&quot;</span><span class="s">price</span><span class="s">&quot;</span>)       
        ]</pre>
</td>
</tr>
</table>

<p>Now we have our mappings along with our transformations we need to actually be able to run this code. This is where things get a little bit nasty.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs133', 331)" onmouseover="showTip(event, 'fs133', 331)" class="i">etl</span> <span onmouseout="hideTip(event, 'fs134', 332)" onmouseover="showTip(event, 'fs134', 332)" class="i">transform</span> <span onmouseout="hideTip(event, 'fs135', 333)" onmouseover="showTip(event, 'fs135', 333)" class="i">load</span> <span onmouseout="hideTip(event, 'fs136', 334)" onmouseover="showTip(event, 'fs136', 334)" class="i">extract</span> <span class="o">=</span> 
        <span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs137', 335)" onmouseover="showTip(event, 'fs137', 335)" class="i">getSet</span> (<span onmouseout="hideTip(event, 'fs138', 336)" onmouseover="showTip(event, 'fs138', 336)" class="i">get</span>,<span onmouseout="hideTip(event, 'fs139', 337)" onmouseover="showTip(event, 'fs139', 337)" class="i">set</span>) <span onmouseout="hideTip(event, 'fs140', 338)" onmouseover="showTip(event, 'fs140', 338)" class="i">load</span> <span onmouseout="hideTip(event, 'fs141', 339)" onmouseover="showTip(event, 'fs141', 339)" class="i">source</span> <span class="o">=</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs142', 340)" onmouseover="showTip(event, 'fs142', 340)" class="i">value</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs143', 341)" onmouseover="showTip(event, 'fs143', 341)" class="i">Optic</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs144', 342)" onmouseover="showTip(event, 'fs144', 342)" class="i">get</span> <span onmouseout="hideTip(event, 'fs138', 343)" onmouseover="showTip(event, 'fs138', 343)" class="i">get</span> <span onmouseout="hideTip(event, 'fs141', 344)" onmouseover="showTip(event, 'fs141', 344)" class="i">source</span>)
            <span onmouseout="hideTip(event, 'fs143', 345)" onmouseover="showTip(event, 'fs143', 345)" class="i">Optic</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs145', 346)" onmouseover="showTip(event, 'fs145', 346)" class="i">set</span> <span onmouseout="hideTip(event, 'fs139', 347)" onmouseover="showTip(event, 'fs139', 347)" class="i">set</span> <span onmouseout="hideTip(event, 'fs142', 348)" onmouseover="showTip(event, 'fs142', 348)" class="i">value</span> <span onmouseout="hideTip(event, 'fs140', 349)" onmouseover="showTip(event, 'fs140', 349)" class="i">load</span>

        <span onmouseout="hideTip(event, 'fs136', 350)" onmouseover="showTip(event, 'fs136', 350)" class="i">extract</span>()
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs44', 351)" onmouseover="showTip(event, 'fs44', 351)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs146', 352)" onmouseover="showTip(event, 'fs146', 352)" class="i">indexed</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs44', 353)" onmouseover="showTip(event, 'fs44', 353)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs147', 354)" onmouseover="showTip(event, 'fs147', 354)" class="i">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs148', 355)" onmouseover="showTip(event, 'fs148', 355)" class="i">loader</span> (<span onmouseout="hideTip(event, 'fs149', 356)" onmouseover="showTip(event, 'fs149', 356)" class="i">rowNumber</span>, <span onmouseout="hideTip(event, 'fs150', 357)" onmouseover="showTip(event, 'fs150', 357)" class="i">x</span>) <span class="k">-&gt;</span> 
                        (<span onmouseout="hideTip(event, 'fs134', 358)" onmouseover="showTip(event, 'fs134', 358)" class="i">transform</span> <span onmouseout="hideTip(event, 'fs149', 359)" onmouseover="showTip(event, 'fs149', 359)" class="i">rowNumber</span>)
                        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs44', 360)" onmouseover="showTip(event, 'fs44', 360)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs147', 361)" onmouseover="showTip(event, 'fs147', 361)" class="i">fold</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs148', 362)" onmouseover="showTip(event, 'fs148', 362)" class="i">loader</span> <span onmouseout="hideTip(event, 'fs151', 363)" onmouseover="showTip(event, 'fs151', 363)" class="i">mapping</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs137', 364)" onmouseover="showTip(event, 'fs137', 364)" class="i">getSet</span> <span onmouseout="hideTip(event, 'fs151', 365)" onmouseover="showTip(event, 'fs151', 365)" class="i">mapping</span> <span onmouseout="hideTip(event, 'fs148', 366)" onmouseover="showTip(event, 'fs148', 366)" class="i">loader</span> <span onmouseout="hideTip(event, 'fs150', 367)" onmouseover="showTip(event, 'fs150', 367)" class="i">x</span>) <span onmouseout="hideTip(event, 'fs148', 368)" onmouseover="showTip(event, 'fs148', 368)" class="i">loader</span>) <span onmouseout="hideTip(event, 'fs135', 369)" onmouseover="showTip(event, 'fs135', 369)" class="i">load</span></pre>
</td>
</tr>
</table>

<p>URRGH!! WTF! But as nasty as this function looks, it is actaully quiet simple; and completely general and only needs to be written once. It simply iterates over the incoming data and applies an index to this data, this represents the row number. We then fold over this indexed data, with each fold we fold over each over the mappings, reading from the first optic supplied by the mappings list then sending the value to the second optic, because of the definition lenses of setting the value means it returns to object the value was applied to, which is then returned by the fold.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs152', 370)" onmouseover="showTip(event, 'fs152', 370)" class="i">extract</span>() <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs74', 371)" onmouseover="showTip(event, 'fs74', 371)" class="i">path</span> <span class="o">=</span> <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;</span><span class="s">/</span><span class="s">data</span><span class="s">/</span><span class="s">lenses</span><span class="s">/</span><span class="s">source_data</span><span class="s">.</span><span class="s">xml</span><span class="s">&quot;</span>
        <span onmouseout="hideTip(event, 'fs153', 372)" onmouseover="showTip(event, 'fs153', 372)" class="i">XDocument</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs154', 373)" onmouseover="showTip(event, 'fs154', 373)" class="i">Load</span>(<span onmouseout="hideTip(event, 'fs74', 374)" onmouseover="showTip(event, 'fs74', 374)" class="i">path</span>)<span class="o">.</span><span class="i">XPathSelectElements</span>(<span class="s">&quot;</span><span class="s">/</span><span class="s">/</span><span class="s">catalog_item</span><span class="s">/</span><span class="s">size</span><span class="s">&quot;</span>)

    <span onmouseout="hideTip(event, 'fs133', 375)" onmouseover="showTip(event, 'fs133', 375)" class="i">etl</span> <span onmouseout="hideTip(event, 'fs132', 376)" onmouseover="showTip(event, 'fs132', 376)" class="i">mappings</span> <span onmouseout="hideTip(event, 'fs98', 377)" onmouseover="showTip(event, 'fs98', 377)" class="i">Csv</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs155', 378)" onmouseover="showTip(event, 'fs155', 378)" class="i">Empty</span> <span onmouseout="hideTip(event, 'fs152', 379)" onmouseover="showTip(event, 'fs152', 379)" class="i">extract</span></pre>
</td>
</tr>
</table>

<p>This returns the same as out original solution which is good,</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="i">item_no</span>,<span class="i">description</span>,<span class="i">gender</span>,<span class="i">size</span>,<span class="i">short_size</span>,<span class="i">price</span>
<span class="i">QWZ5671</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Men&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">39.95</span>
<span class="i">QWZ5671</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Men&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">39.95</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Small</span>,<span class="i">S</span>,<span class="n">42.50</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">42.50</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">42.50</span>
<span class="i">RRX9856</span>,<span class="i">FSharp</span> <span class="i">Sweater</span>,<span class="i">Women&#39;s</span>,<span class="i">Extra</span> <span class="i">Large</span>,<span class="i">XL</span>,<span class="n">42.50</span>
<span class="i">QWZ8976</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Men&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">39.95</span>
<span class="i">QWZ8976</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Men&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">39.95</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Small</span>,<span class="i">S</span>,<span class="n">42.50</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Medium</span>,<span class="i">M</span>,<span class="n">42.50</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Large</span>,<span class="i">L</span>,<span class="n">42.50</span>
<span class="i">RRX345</span>,<span class="i">FSharp</span> <span class="i">T</span><span class="o">-</span><span class="i">Shirt</span>,<span class="i">Women&#39;s</span>,<span class="i">Extra</span> <span class="i">Large</span>,<span class="i">XL</span>,<span class="n">42.50</span></pre>
</td>
</tr>
</table>

<p>and now the mapping is essentially just data. However it is still compiled, so all we have really bought ourselves is turning the mappings into a list. Or have we? Lets have a closer look.</p>

<p>When we defined our lenses and transformations we defined things in a very specific way. The reason for this is for composablility, the lens solution allows us to implement pretty much any mapping and transformation we want without ever changing the overall structure of the solution. If I wanted to for example write this to a .NET datatable rather than CSV file then I create a function that provides, getters and setters to an instance of a datatable replace that with the CSV ones. In addition the Optic over the datatable can then be put as a gist, shared assembly or however you use common code and re-used.</p>

<p>So, what do you think? Are optics worth it? In my opinion apart from the plumbing code <code>etl</code> function (which is written once) the rest of the code is very simple and could be read by anyone, even maybe the business; which at the end of the day is what all enterprise devs try to acheive as it makes, their lives that little bit easier :).</p>

<p><em>Many YAK's have been shorn but none hurt</em></p>


<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Linq</div>
<div class="tip" id="fs3">namespace System.Collections</div>
<div class="tip" id="fs4">namespace System.Collections.Generic</div>
<div class="tip" id="fs5">namespace System.Xml</div>
<div class="tip" id="fs6">namespace System.Xml.Linq</div>
<div class="tip" id="fs7">namespace System.Xml.XPath</div>
<div class="tip" id="fs8">module Aether</div>
<div class="tip" id="fs9">module Operators<br /><br />from Aether</div>
<div class="tip" id="fs10">namespace FSharp</div>
<div class="tip" id="fs11">namespace FSharp.Data</div>
<div class="tip" id="fs12">module EnterpriseOptics<br /><br />from 2016-05-16-Enterprise-Optics</div>
<div class="tip" id="fs13">Multiple items<br />type Csv =<br />&#160;&#160;private new : headers:string [] * ?data:string [] [] -&gt; Csv<br />&#160;&#160;member GetValue : col:string * indx:int -&gt; string option<br />&#160;&#160;member Save : path:string -&gt; unit<br />&#160;&#160;member SetValue : col:string * indx:int * value:&#39;a -&gt; &#39;b<br />&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;member Data : string [] []<br />&#160;&#160;static member Create : headers:string [] * ?data:string [] [] -&gt; Csv<br />&#160;&#160;static member Read : file:string -&gt; Csv<br />&#160;&#160;static member Empty : Csv<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv<br /><br />--------------------<br />private new : headers:string [] * ?data:string [] [] -&gt; Csv</div>
<div class="tip" id="fs14">val headers : string []</div>
<div class="tip" id="fs15">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs16">val data : string [] [] option</div>
<div class="tip" id="fs17">val headers : List&lt;string&gt;</div>
<div class="tip" id="fs18">type ResizeArray&lt;&#39;T&gt; = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.ResizeArray&lt;_&gt;</div>
<div class="tip" id="fs19">val data : List&lt;List&lt;string&gt;&gt;</div>
<div class="tip" id="fs20">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs21">val data : string [] []</div>
<div class="tip" id="fs22">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : params indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs23">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map</div>
<div class="tip" id="fs24">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs25">static member Csv.Empty : Csv<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.Empty</div>
<div class="tip" id="fs26">static member Csv.Create : headers:string [] * ?data:string [] [] -&gt; Csv<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.Create</div>
<div class="tip" id="fs27">val defaultArg : arg:&#39;T option -&gt; defaultValue:&#39;T -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.defaultArg</div>
<div class="tip" id="fs28">static member Csv.Read : file:string -&gt; Csv<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.Read</div>
<div class="tip" id="fs29">val file : string</div>
<div class="tip" id="fs30">val csv : CsvFile</div>
<div class="tip" id="fs31">type CsvFile =<br />&#160;&#160;inherit CsvFile&lt;CsvRow&gt;<br />&#160;&#160;private new : readerFunc:Func&lt;TextReader&gt; * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />&#160;&#160;member private GetColumnIndex : columnName:string -&gt; int<br />&#160;&#160;static member AsyncLoad : uri:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; Async&lt;CsvFile&gt;<br />&#160;&#160;static member Load : uri:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />&#160;&#160;static member Load : reader:TextReader * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />&#160;&#160;static member Load : stream:Stream * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />&#160;&#160;static member Parse : text:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br /><br />Full name: FSharp.Data.CsvFile</div>
<div class="tip" id="fs32">static member CsvFile.Load : uri:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />static member CsvFile.Load : reader:IO.TextReader * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />static member CsvFile.Load : stream:IO.Stream * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile</div>
<div class="tip" id="fs33">property Runtime.CsvFile.Headers: string [] option</div>
<div class="tip" id="fs34">val hs : string []</div>
<div class="tip" id="fs35">val failwithf : format:Printf.StringFormat&lt;&#39;T,&#39;Result&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.failwithf</div>
<div class="tip" id="fs36">val header : string</div>
<div class="tip" id="fs37">val row : CsvRow</div>
<div class="tip" id="fs38">property Runtime.CsvFile.Rows: seq&lt;CsvRow&gt;</div>
<div class="tip" id="fs39">member CsvRow.GetColumn : columnName:string -&gt; string<br />member CsvRow.GetColumn : index:int -&gt; string</div>
<div class="tip" id="fs40">val x : Csv</div>
<div class="tip" id="fs41">member Csv.GetValue : col:string * indx:int -&gt; string option<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.GetValue</div>
<div class="tip" id="fs42">val col : string</div>
<div class="tip" id="fs43">val indx : int</div>
<div class="tip" id="fs44">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs45">val tryItem : index:int -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;T option<br /><br />Full name: Microsoft.FSharp.Collections.Seq.tryItem</div>
<div class="tip" id="fs46">val row : List&lt;string&gt;</div>
<div class="tip" id="fs47">val tryFindIndex : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; int option<br /><br />Full name: Microsoft.FSharp.Collections.Seq.tryFindIndex</div>
<div class="tip" id="fs48">Multiple items<br />module Option<br /><br />from Aether.Optics<br /><br />--------------------<br />module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs49">val bind : binder:(&#39;T -&gt; &#39;U option) -&gt; option:&#39;T option -&gt; &#39;U option<br /><br />Full name: Microsoft.FSharp.Core.Option.bind</div>
<div class="tip" id="fs50">val colIndx : int</div>
<div class="tip" id="fs51">member Csv.SetValue : col:string * indx:int * value:&#39;a -&gt; &#39;b<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.SetValue</div>
<div class="tip" id="fs52">val value : &#39;a</div>
<div class="tip" id="fs53">val colIndex : int</div>
<div class="tip" id="fs54">List.Insert(index: int, item: string) : unit</div>
<div class="tip" id="fs55">List.Add(item: string) : unit</div>
<div class="tip" id="fs56">Multiple items<br />property List.Count: int<br /><br />--------------------<br />(extension) IEnumerable.Count&lt;&#39;TSource&gt;() : int<br />(extension) IEnumerable.Count&lt;&#39;TSource&gt;(predicate: Func&lt;&#39;TSource,bool&gt;) : int</div>
<div class="tip" id="fs57">List.Add(item: List&lt;string&gt;) : unit</div>
<div class="tip" id="fs58">member Csv.SetValue : col:string * indx:int * value:&#39;a -&gt; &#39;b</div>
<div class="tip" id="fs59">Multiple items<br />member Csv.Data : string [] []<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.Data<br /><br />--------------------<br />namespace System.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs60">val toArray : source:seq&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toArray</div>
<div class="tip" id="fs61">val value : string</div>
<div class="tip" id="fs62">override Csv.ToString : unit -&gt; string<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.ToString</div>
<div class="tip" id="fs63">val sb : Text.StringBuilder</div>
<div class="tip" id="fs64">Multiple items<br />union case HttpResponseBody.Text: string -&gt; HttpResponseBody<br /><br />--------------------<br />namespace System.Text</div>
<div class="tip" id="fs65">Multiple items<br />type StringBuilder =<br />&#160;&#160;new : unit -&gt; StringBuilder + 5 overloads<br />&#160;&#160;member Append : value:string -&gt; StringBuilder + 18 overloads<br />&#160;&#160;member AppendFormat : format:string * arg0:obj -&gt; StringBuilder + 4 overloads<br />&#160;&#160;member AppendLine : unit -&gt; StringBuilder + 1 overload<br />&#160;&#160;member Capacity : int with get, set<br />&#160;&#160;member Chars : int -&gt; char with get, set<br />&#160;&#160;member Clear : unit -&gt; StringBuilder<br />&#160;&#160;member CopyTo : sourceIndex:int * destination:char[] * destinationIndex:int * count:int -&gt; unit<br />&#160;&#160;member EnsureCapacity : capacity:int -&gt; int<br />&#160;&#160;member Equals : sb:StringBuilder -&gt; bool<br />&#160;&#160;...<br /><br />Full name: System.Text.StringBuilder<br /><br />--------------------<br />Text.StringBuilder() : unit<br />Text.StringBuilder(capacity: int) : unit<br />Text.StringBuilder(value: string) : unit<br />Text.StringBuilder(value: string, capacity: int) : unit<br />Text.StringBuilder(capacity: int, maxCapacity: int) : unit<br />Text.StringBuilder(value: string, startIndex: int, length: int, capacity: int) : unit</div>
<div class="tip" id="fs66">val row : string []</div>
<div class="tip" id="fs67">property Csv.Data: string [] []</div>
<div class="tip" id="fs68">Text.StringBuilder.AppendLine() : Text.StringBuilder<br />Text.StringBuilder.AppendLine(value: string) : Text.StringBuilder</div>
<div class="tip" id="fs69">Multiple items<br />type String =<br />&#160;&#160;new : value:char -&gt; string + 7 overloads<br />&#160;&#160;member Chars : int -&gt; char<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;member Contains : value:string -&gt; bool<br />&#160;&#160;member CopyTo : sourceIndex:int * destination:char[] * destinationIndex:int * count:int -&gt; unit<br />&#160;&#160;member EndsWith : value:string -&gt; bool + 2 overloads<br />&#160;&#160;member Equals : obj:obj -&gt; bool + 2 overloads<br />&#160;&#160;member GetEnumerator : unit -&gt; CharEnumerator<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;...<br /><br />Full name: System.String<br /><br />--------------------<br />String(value: nativeptr&lt;char&gt;) : unit<br />String(value: nativeptr&lt;sbyte&gt;) : unit<br />String(value: char []) : unit<br />String(c: char, count: int) : unit<br />String(value: nativeptr&lt;char&gt;, startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int) : unit<br />String(value: char [], startIndex: int, length: int) : unit<br />String(value: nativeptr&lt;sbyte&gt;, startIndex: int, length: int, enc: Text.Encoding) : unit</div>
<div class="tip" id="fs70">val concat : sep:string -&gt; strings:seq&lt;string&gt; -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.String.concat</div>
<div class="tip" id="fs71">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs72">Text.StringBuilder.ToString() : string<br />Text.StringBuilder.ToString(startIndex: int, length: int) : string</div>
<div class="tip" id="fs73">member Csv.Save : path:string -&gt; unit<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv.Save</div>
<div class="tip" id="fs74">val path : string</div>
<div class="tip" id="fs75">namespace System.IO</div>
<div class="tip" id="fs76">type File =<br />&#160;&#160;static member AppendAllLines : path:string * contents:IEnumerable&lt;string&gt; -&gt; unit + 1 overload<br />&#160;&#160;static member AppendAllText : path:string * contents:string -&gt; unit + 1 overload<br />&#160;&#160;static member AppendText : path:string -&gt; StreamWriter<br />&#160;&#160;static member Copy : sourceFileName:string * destFileName:string -&gt; unit + 1 overload<br />&#160;&#160;static member Create : path:string -&gt; FileStream + 3 overloads<br />&#160;&#160;static member CreateText : path:string -&gt; StreamWriter<br />&#160;&#160;static member Decrypt : path:string -&gt; unit<br />&#160;&#160;static member Delete : path:string -&gt; unit<br />&#160;&#160;static member Encrypt : path:string -&gt; unit<br />&#160;&#160;static member Exists : path:string -&gt; bool<br />&#160;&#160;...<br /><br />Full name: System.IO.File</div>
<div class="tip" id="fs77">IO.File.WriteAllText(path: string, contents: string) : unit<br />IO.File.WriteAllText(path: string, contents: string, encoding: Text.Encoding) : unit</div>
<div class="tip" id="fs78">override Csv.ToString : unit -&gt; string</div>
<div class="tip" id="fs79">val longSizeToShortSize : _arg1:string -&gt; string<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.longSizeToShortSize</div>
<div class="tip" id="fs80">val a : string</div>
<div class="tip" id="fs81">val shortSizeToLongSize : _arg1:string -&gt; string<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.shortSizeToLongSize</div>
<div class="tip" id="fs82">type Catalog = XmlProvider&lt;...&gt;<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Catalog</div>
<div class="tip" id="fs83">type XmlProvider<br /><br />Full name: FSharp.Data.XmlProvider<br /><em><br /><br />&lt;summary&gt;Typed representation of a XML file.&lt;/summary&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;Sample&#39;&gt;Location of a XML sample file or a string containing a sample XML document.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;SampleIsList&#39;&gt;If true, the children of the root in the sample document represent individual samples for the inference.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;Global&#39;&gt;If true, the inference unifies all XML elements with the same name.&lt;/param&gt;                     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;Culture&#39;&gt;The culture used for parsing numbers and dates. Defaults to the invariant culture.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;Encoding&#39;&gt;The encoding used to read the sample. You can specify either the character set name or the codepage number. Defaults to UTF8 for files, and to ISO-8859-1 the for HTTP requests, unless `charset` is specified in the `Content-Type` response header.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;ResolutionFolder&#39;&gt;A directory that is used when resolving relative file references (at design time and in hosted execution).&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;EmbeddedResource&#39;&gt;When specified, the type provider first attempts to load the sample from the specified resource <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(e.g. &#39;MyCompany.MyAssembly, resource_name.xml&#39;). This is useful when exposing types generated by the type provider.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;InferTypesFromValues&#39;&gt;If true, turns on additional type inference from values. <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(e.g. type inference infers string values such as &quot;123&quot; as ints and values constrained to 0 and 1 as booleans. The XmlProvider also infers string values as JSON.)&lt;/param&gt;</em></div>
<div class="tip" id="fs84">val run : path:string -&gt; Csv<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.run</div>
<div class="tip" id="fs85">val data : XmlProvider&lt;...&gt;.Catalog</div>
<div class="tip" id="fs86">XmlProvider&lt;...&gt;.Load(uri: string) : XmlProvider&lt;...&gt;.Catalog<br /><em><br /><br />Loads XML from the specified uri</em><br />XmlProvider&lt;...&gt;.Load(reader: IO.TextReader) : XmlProvider&lt;...&gt;.Catalog<br /><em><br /><br />Loads XML from the specified reader</em><br />XmlProvider&lt;...&gt;.Load(stream: IO.Stream) : XmlProvider&lt;...&gt;.Catalog<br /><em><br /><br />Loads XML from the specified stream</em></div>
<div class="tip" id="fs87">val product : XmlProvider&lt;...&gt;.Product</div>
<div class="tip" id="fs88">property XmlProvider&lt;...&gt;.Catalog.Products: XmlProvider&lt;...&gt;.Product []</div>
<div class="tip" id="fs89">val catalogItem : XmlProvider&lt;...&gt;.CatalogItem</div>
<div class="tip" id="fs90">property XmlProvider&lt;...&gt;.Product.CatalogItems: XmlProvider&lt;...&gt;.CatalogItem []</div>
<div class="tip" id="fs91">val size : XmlProvider&lt;...&gt;.Size</div>
<div class="tip" id="fs92">property XmlProvider&lt;...&gt;.CatalogItem.Sizes: XmlProvider&lt;...&gt;.Size []</div>
<div class="tip" id="fs93">property XmlProvider&lt;...&gt;.CatalogItem.ItemNumber: string</div>
<div class="tip" id="fs94">property XmlProvider&lt;...&gt;.Product.Description: string</div>
<div class="tip" id="fs95">property XmlProvider&lt;...&gt;.CatalogItem.Gender: string</div>
<div class="tip" id="fs96">property XmlProvider&lt;...&gt;.Size.Description: string</div>
<div class="tip" id="fs97">property XmlProvider&lt;...&gt;.CatalogItem.Price: decimal</div>
<div class="tip" id="fs98">type Csv =<br />&#160;&#160;private new : headers:string [] * ?data:string [] [] -&gt; Csv<br />&#160;&#160;member GetValue : col:string * indx:int -&gt; string option<br />&#160;&#160;member Save : path:string -&gt; unit<br />&#160;&#160;member SetValue : col:string * indx:int * value:&#39;a -&gt; &#39;b<br />&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;member Data : string [] []<br />&#160;&#160;static member Create : headers:string [] * ?data:string [] [] -&gt; Csv<br />&#160;&#160;static member Read : file:string -&gt; Csv<br />&#160;&#160;static member Empty : Csv<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.Csv</div>
<div class="tip" id="fs99">static member Csv.Create : headers:string [] * ?data:string [] [] -&gt; Csv</div>
<div class="tip" id="fs100">val xpath : path:string -&gt; Lens&lt;XElement,&#39;a&gt;<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.xpath</div>
<div class="tip" id="fs101">Multiple items<br />module Lens<br /><br />from Aether<br /><br />--------------------<br />type Lens&lt;&#39;a,&#39;b&gt; = (&#39;a -&gt; &#39;b) * (&#39;b -&gt; &#39;a -&gt; &#39;a)<br /><br />Full name: Aether.Lens&lt;_,_&gt;</div>
<div class="tip" id="fs102">Multiple items<br />type XElement =<br />&#160;&#160;inherit XContainer<br />&#160;&#160;new : name:XName -&gt; XElement + 4 overloads<br />&#160;&#160;member AncestorsAndSelf : unit -&gt; IEnumerable&lt;XElement&gt; + 1 overload<br />&#160;&#160;member Attribute : name:XName -&gt; XAttribute<br />&#160;&#160;member Attributes : unit -&gt; IEnumerable&lt;XAttribute&gt; + 1 overload<br />&#160;&#160;member DescendantNodesAndSelf : unit -&gt; IEnumerable&lt;XNode&gt;<br />&#160;&#160;member DescendantsAndSelf : unit -&gt; IEnumerable&lt;XElement&gt; + 1 overload<br />&#160;&#160;member FirstAttribute : XAttribute<br />&#160;&#160;member GetDefaultNamespace : unit -&gt; XNamespace<br />&#160;&#160;member GetNamespaceOfPrefix : prefix:string -&gt; XNamespace<br />&#160;&#160;member GetPrefixOfNamespace : ns:XNamespace -&gt; string<br />&#160;&#160;...<br /><br />Full name: System.Xml.Linq.XElement<br /><br />--------------------<br />XElement(name: XName) : unit<br />XElement(other: XElement) : unit<br />XElement(other: XStreamingElement) : unit<br />XElement(name: XName, content: obj) : unit<br />XElement(name: XName, params content: obj []) : unit</div>
<div class="tip" id="fs103">val x : XElement</div>
<div class="tip" id="fs104">(extension) XNode.XPathEvaluate(expression: string) : obj<br />(extension) XNode.XPathEvaluate(expression: string, resolver: Xml.IXmlNamespaceResolver) : obj</div>
<div class="tip" id="fs105">Multiple items<br />type IEnumerable =<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br /><br />Full name: System.Collections.IEnumerable<br /><br />--------------------<br />type IEnumerable&lt;&#39;T&gt; =<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator&lt;&#39;T&gt;<br /><br />Full name: System.Collections.Generic.IEnumerable&lt;_&gt;</div>
<div class="tip" id="fs106">val s : &#39;a</div>
<div class="tip" id="fs107">val xml&lt;&#39;a&gt; : defaultV:string -&gt; path:string -&gt; Lens&lt;XElement,string&gt;<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.xml</div>
<div class="tip" id="fs108">val defaultV : string</div>
<div class="tip" id="fs109">val getValue : (string -&gt; obj -&gt; string)</div>
<div class="tip" id="fs110">val x : obj</div>
<div class="tip" id="fs111">type obj = Object<br /><br />Full name: Microsoft.FSharp.Core.obj</div>
<div class="tip" id="fs112">Multiple items<br />type XAttribute =<br />&#160;&#160;inherit XObject<br />&#160;&#160;new : other:XAttribute -&gt; XAttribute + 1 overload<br />&#160;&#160;member IsNamespaceDeclaration : bool<br />&#160;&#160;member Name : XName<br />&#160;&#160;member NextAttribute : XAttribute<br />&#160;&#160;member NodeType : XmlNodeType<br />&#160;&#160;member PreviousAttribute : XAttribute<br />&#160;&#160;member Remove : unit -&gt; unit<br />&#160;&#160;member SetValue : value:obj -&gt; unit<br />&#160;&#160;member ToString : unit -&gt; string<br />&#160;&#160;member Value : string with get, set<br />&#160;&#160;...<br /><br />Full name: System.Xml.Linq.XAttribute<br /><br />--------------------<br />XAttribute(other: XAttribute) : unit<br />XAttribute(name: XName, value: obj) : unit</div>
<div class="tip" id="fs113">val a : XAttribute</div>
<div class="tip" id="fs114">property XAttribute.Value: string</div>
<div class="tip" id="fs115">val e : XElement</div>
<div class="tip" id="fs116">property XElement.Value: string</div>
<div class="tip" id="fs117">val setValue : (obj -&gt; &#39;b -&gt; &#39;c)</div>
<div class="tip" id="fs118">val v : &#39;b</div>
<div class="tip" id="fs119">XAttribute.SetValue(value: obj) : unit</div>
<div class="tip" id="fs120">XElement.SetValue(value: obj) : unit</div>
<div class="tip" id="fs121">val unbox : value:obj -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.unbox</div>
<div class="tip" id="fs122">val l : Lens&lt;&#39;b,string&gt;</div>
<div class="tip" id="fs123">val x : &#39;b</div>
<div class="tip" id="fs124">val s : string</div>
<div class="tip" id="fs125">val xattr : (string -&gt; string -&gt; Lens&lt;XElement,string&gt;)<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.xattr</div>
<div class="tip" id="fs126">val xelem : (string -&gt; string -&gt; Lens&lt;XElement,string&gt;)<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.xelem</div>
<div class="tip" id="fs127">val csv : indx:int -&gt; col:string -&gt; Prism&lt;Csv,string&gt;<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.csv</div>
<div class="tip" id="fs128">Multiple items<br />module Prism<br /><br />from Aether<br /><br />--------------------<br />type Prism&lt;&#39;a,&#39;b&gt; = (&#39;a -&gt; &#39;b option) * (&#39;b -&gt; &#39;a -&gt; &#39;a)<br /><br />Full name: Aether.Prism&lt;_,_&gt;</div>
<div class="tip" id="fs129">member Csv.GetValue : col:string * indx:int -&gt; string option</div>
<div class="tip" id="fs130">val shortSize : Isomorphism&lt;string,string&gt;<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.shortSize</div>
<div class="tip" id="fs131">type Isomorphism&lt;&#39;a,&#39;b&gt; = (&#39;a -&gt; &#39;b) * (&#39;b -&gt; &#39;a)<br /><br />Full name: Aether.Isomorphism&lt;_,_&gt;</div>
<div class="tip" id="fs132">val mappings : indx:int -&gt; (Lens&lt;XElement,string&gt; * Prism&lt;Csv,string&gt;) list<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.mappings</div>
<div class="tip" id="fs133">val etl : transform:(int -&gt; #seq&lt;&#39;b * &#39;e&gt;) -&gt; load:&#39;f -&gt; extract:(unit -&gt; #seq&lt;&#39;c&gt;) -&gt; &#39;f (requires member ( ^. ) and member ( ^= ))<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.etl</div>
<div class="tip" id="fs134">val transform : (int -&gt; #seq&lt;&#39;b * &#39;e&gt;) (requires member ( ^. ) and member ( ^= ))</div>
<div class="tip" id="fs135">val load : &#39;f</div>
<div class="tip" id="fs136">val extract : (unit -&gt; #seq&lt;&#39;c&gt;)</div>
<div class="tip" id="fs137">val getSet : (&#39;h * &#39;k -&gt; &#39;l -&gt; &#39;i -&gt; &#39;m) (requires member ( ^. ) and member ( ^= ))</div>
<div class="tip" id="fs138">val get : &#39;h (requires member ( ^. ))</div>
<div class="tip" id="fs139">val set : &#39;k (requires member ( ^= ))</div>
<div class="tip" id="fs140">val load : &#39;l</div>
<div class="tip" id="fs141">val source : &#39;i</div>
<div class="tip" id="fs142">val value : &#39;j</div>
<div class="tip" id="fs143">module Optic<br /><br />from Aether</div>
<div class="tip" id="fs144">val get : optic:&#39;a -&gt; target:&#39;b -&gt; &#39;c (requires member ( ^. ))<br /><br />Full name: Aether.Optic.get</div>
<div class="tip" id="fs145">val set : optic:&#39;a -&gt; value:&#39;b -&gt; &#39;c (requires member ( ^= ))<br /><br />Full name: Aether.Optic.set</div>
<div class="tip" id="fs146">val indexed : source:seq&lt;&#39;T&gt; -&gt; seq&lt;int * &#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.indexed</div>
<div class="tip" id="fs147">val fold : folder:(&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state:&#39;State -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Collections.Seq.fold</div>
<div class="tip" id="fs148">val loader : &#39;f</div>
<div class="tip" id="fs149">val rowNumber : int</div>
<div class="tip" id="fs150">val x : &#39;c</div>
<div class="tip" id="fs151">val mapping : &#39;b * &#39;e (requires member ( ^. ) and member ( ^= ))</div>
<div class="tip" id="fs152">val extract : unit -&gt; IEnumerable&lt;XElement&gt;<br /><br />Full name: 2016-05-16-Enterprise-Optics.EnterpriseOptics.extract</div>
<div class="tip" id="fs153">Multiple items<br />type XDocument =<br />&#160;&#160;inherit XContainer<br />&#160;&#160;new : unit -&gt; XDocument + 3 overloads<br />&#160;&#160;member Declaration : XDeclaration with get, set<br />&#160;&#160;member DocumentType : XDocumentType<br />&#160;&#160;member NodeType : XmlNodeType<br />&#160;&#160;member Root : XElement<br />&#160;&#160;member Save : fileName:string -&gt; unit + 6 overloads<br />&#160;&#160;member WriteTo : writer:XmlWriter -&gt; unit<br />&#160;&#160;static member Load : uri:string -&gt; XDocument + 7 overloads<br />&#160;&#160;static member Parse : text:string -&gt; XDocument + 1 overload<br /><br />Full name: System.Xml.Linq.XDocument<br /><br />--------------------<br />XDocument() : unit<br />XDocument(params content: obj []) : unit<br />XDocument(other: XDocument) : unit<br />XDocument(declaration: XDeclaration, params content: obj []) : unit</div>
<div class="tip" id="fs154">XDocument.Load(reader: Xml.XmlReader) : XDocument<br />XDocument.Load(textReader: IO.TextReader) : XDocument<br />XDocument.Load(stream: IO.Stream) : XDocument<br />XDocument.Load(uri: string) : XDocument<br />XDocument.Load(reader: Xml.XmlReader, options: LoadOptions) : XDocument<br />XDocument.Load(textReader: IO.TextReader, options: LoadOptions) : XDocument<br />XDocument.Load(stream: IO.Stream, options: LoadOptions) : XDocument<br />XDocument.Load(uri: string, options: LoadOptions) : XDocument</div>
<div class="tip" id="fs155">property Csv.Empty: Csv</div>
